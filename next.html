<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dress Try Portal ðŸ’–</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Mobile flicker fix */
        html {
            -webkit-tap-highlight-color: transparent;
            -webkit-overflow-scrolling: touch;
        }

        body {
            min-height: 100vh;
            background: 
                linear-gradient(45deg, 
                    #620080 25%, 
                    #8a2be2 75%);
            font-family: 'Courier New', monospace;
            overflow: hidden;
            position: relative;
            /* Hardware acceleration */
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            transform: translateZ(0);
            color: white;
        }

        body::before {
            content: '';
            position: fixed;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='52' height='52' viewBox='0 0 52 52' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M26 35.5C17.6 35.5 4 29.5 4 17.5 4 9.5 11.7 3 21.5 3c5.1 0 8.7 2.5 11.5 6 2.8-3.5 6.4-6 11.5-6C40.3 3 48 9.5 48 17.5c0 12-13.6 18-22 18z' fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
            z-index: -1;
            pointer-events: none;
            will-change: transform;
        }

        .dress-container {
            width: 100%;
            min-height: 100vh;
            padding: 2rem;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .dress-title {
            font-size: 3rem;
            color: white;
            margin-bottom: 2rem;
            text-shadow: 0 0 20px rgba(255, 105, 180, 0.6);
            letter-spacing: 1px;
        }

        .dress-content {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 3rem;
            flex-wrap: wrap;
            max-width: 1200px;
            margin: 0 auto;
        }

        .image-box {
            width: 400px;
            max-width: 90%;
            height: 620px;
            background: rgba(255,255,255,0.08);
            border-radius: 20px;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.12);
            box-shadow: 0 8px 32px rgba(0,0,0,0.35);
        }

        .image-box img {
            width: 100%;
            height: 100%;
            object-fit: contain;          /* better for full-body â†’ prevents cropping head/feet */
            object-position: center;
            transition: opacity 0.4s ease;
            background: rgba(0,0,0,0.2);
        }

        .upload-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            max-width: 340px;
        }

        .upload-text {
            color: white;
            font-size: 1.3rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            line-height: 1.4;
        }

        /* Hide actual input */
        #dressUpload {
            display: none;
        }

        .valentine-btn {
            padding: 1rem 3rem;
            font-size: 1.4rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background: #ff4081;
            color: white;
            box-shadow: 0 6px 20px rgba(255,64,129,0.5);
        }

        .valentine-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(255,64,129,0.7);
            background: #ff1a6e;
        }

        .valentine-btn:active {
            transform: translateY(1px);
        }

        .valentine-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 300px;
            background: rgba(255,255,255,0.25);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            animation: ripple 0.7s ease-out;
            pointer-events: none;
        }

        @keyframes ripple {
            to {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .dress-content {
                flex-direction: column;
                gap: 2.5rem;
            }
            .image-box {
                height: 520px;
            }
            .dress-title {
                font-size: 2.4rem;
            }
        }
    </style>
</head>
<body>

<div class="dress-container">

    <h1 class="dress-title">My Dressup Doll ðŸ’–</h1>

    <div class="dress-content">

        <!-- IMAGE BOX -->
        <div class="image-box">
            <img src="assets/baseimage.jpg" alt="Model" id="previewImage">
        </div>

        <!-- UPLOAD SECTION -->
        <div class="upload-section">
            <p class="upload-text">
                Darling please upload the dress you wanna try âœ¨
            </p>

            <input type="file" id="dressUpload" accept="image/*">
            <button class="valentine-btn upload-btn">
                Upload ðŸ’Œ
            </button>
        </div>

    </div>

</div>

<script>
const BASE_IMAGE_PATH = "assets/baseimage.jpg";
const LOADING_GIF    = "assets/loading.gif" || "https://via.placeholder.com/400x600/333/fff?text=Loading...";

const API_KEY = "papi.8ae7bb40-057e-4e39-836d-847bac6803d0.beZQv3CB3RLaOyYnvkT_OcOjOtcHh36i";
const ENDPOINT = "https://api.reve.com/v1/image/remix";

const uploadInput  = document.getElementById("dressUpload");
const uploadBtn    = document.querySelector(".upload-btn");
const previewImage = document.getElementById("previewImage");

// â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function getBaseImage() {
    try {
        const res = await fetch(BASE_IMAGE_PATH);
        if (!res.ok) throw new Error(`Base image fetch failed: ${res.status}`);
        const blob = await res.blob();

        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result.split(",")[1]);
            reader.onerror = reject;
            reader.readAsDataURL(blob);
        });
    } catch (err) {
        console.error("Failed to load base image:", err);
        throw err;
    }
}

function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result.split(",")[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}

// â”€â”€â”€ Event Listeners â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

uploadBtn.addEventListener("click", () => {
    uploadInput.click();
});

uploadInput.addEventListener("change", async function() {
    const file = this.files?.[0];
    if (!file) return;

    // Show loading
    previewImage.src = LOADING_GIF;
    previewImage.style.opacity = "1";

    try {
        const img1 = await getBaseImage();
        const img2 = await fileToBase64(file);

        const payload = {
            prompt: `Create a realistic full-body portrait by combining two reference images.

Instructions:

Use Image 1 as the base model (face, body proportions, hairstyle, identity).

Replace her outfit with the dress from Image 2, ensuring accurate fabric texture, fit, color, and structural details.

Generate a full-body portrait, centered and fully visible from head to toe.

Pose: standing upright, arms gently held together above the abdomen (hands softly clasped or overlapping), relaxed shoulders, natural posture.

Background: elegant grey curtains covering the backdrop.

Floor: natural wooden flooring with realistic texture and perspective.

Lighting: soft, studio-style lighting with subtle shadows, evenly illuminating the subject.

Style: photorealistic, high detail, sharp focus, natural skin tones.

Composition: vertical portrait orientation, balanced framing, professional fashion photography look.`,
            reference_images: [img1, img2],
            version: "latest-fast"
        };

        const response = await fetch(ENDPOINT, {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${API_KEY}`,
                "Content-Type": "application/json",
                "Accept": "application/json"
            },
            body: JSON.stringify(payload)
        });

        if (!response.ok) {
            throw new Error(`API error: ${response.status} ${await response.text()}`);
        }

        const result = await response.json();

        if (!result.image) {
            console.error("No image in response:", result);
            throw new Error("No generated image returned");
        }

        const generatedImage = "data:image/jpeg;base64," + result.image;

        previewImage.style.opacity = "0";
        setTimeout(() => {
            previewImage.src = generatedImage;
            previewImage.style.opacity = "1";
        }, 100);

    } catch (err) {
        console.error("Dress try-on failed:", err);
        previewImage.src = BASE_IMAGE_PATH;
        alert("Something went wrong... try another dress? ðŸ’”");
    }
});
</script>

</body>
</html>